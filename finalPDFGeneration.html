<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Final Document</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <div id="content">
        <h1>Final Document</h1>
        <p id="fullName"></p>
        <p id="handle"></p>
        <p id="biography"></p>
        <p id="description"></p>
        <img id="imagePreview" src="" alt="Image preview" style="max-width: 100%;"/>

        <h2>Roles:</h2>
        <p id="selectedRole"></p>

        <h2>Lifepath:</h2>
        
        <h2>Friends List:</h2>
        <ul id="friendsList"></ul> <!-- Display friends data here -->
    </div>

    <button id="generatePDF">Generate PDF</button>

    <script>
        // Get data from localStorage
        const fullName = localStorage.getItem('fullName');
        const handle = localStorage.getItem('handle');
        const biography = localStorage.getItem('biography');
        const description = localStorage.getItem('description');
        const imageData = localStorage.getItem('image');

        const selectedRole = localStorage.getItem('selectedRole');

        // Retrieve friends data from localStorage
        const friendsData = JSON.parse(localStorage.getItem('friendsData'));
        
        // Display data in the document
        document.getElementById('fullName').textContent = `Full Name: ${fullName}`;
        document.getElementById('handle').textContent = `Handle: ${handle}`;
        document.getElementById('biography').textContent = `Biography: ${biography}`;
        document.getElementById('description').textContent = `Description: ${description}`;
        
        // Display image if available
        if (imageData) {
            document.getElementById('imagePreview').src = imageData;
        }

        document.getElementById('selectedRole').textContent = `Role: ${selectedRole}`;

        // Display friends list if available
        const friendsListElement = document.getElementById('friendsList');
        if (friendsData && Array.isArray(friendsData)) {
            friendsData.forEach(friend => {
                const listItem = document.createElement('li');
                listItem.textContent = `Name: ${friend.name}, Handle: ${friend.handle}`;
                friendsListElement.appendChild(listItem);
            });
        }

        // Generate PDF using jsPDF
        document.getElementById('generatePDF').addEventListener('click', function() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Add content to the PDF
            doc.text(`Full Name: ${fullName}`, 10, 10);
            doc.text(`Handle: ${handle}`, 10, 20);
            doc.text(`Biography: ${biography}`, 10, 30);
            doc.text(`Description: ${description}`, 10, 40);

            // Add friends to the PDF if available
            if (friendsData && Array.isArray(friendsData)) {
                let yPosition = 50; // Start position for friends list
                friendsData.forEach(friend => {
                    doc.text(`Friend: ${friend.name}, Handle: ${friend.handle}`, 10, yPosition);
                    yPosition += 10; // Increment Y position for next friend
                });
            }

            // If image exists, add it to the PDF
            if (imageData) {
                const img = new Image();
                img.src = imageData;
                img.onload = function() {
                    doc.addImage(img, 'JPEG', 10, 80, 180, 160); // Adjust size and position
                    doc.save('finalDocument.pdf');
                };
            } else {
                doc.save('finalDocument.pdf');
            }
        });
    </script>
</body>
</html>
